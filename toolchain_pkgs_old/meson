ver=0.57.2

[srcs]
https://github.com/mesonbuild/meson/releases/download/%ver/%name-%ver.tar.gz

[build]
cpu="x86_64"
cpuextra="$cpu"
endian="little"

python3 setup.py build
python3 setup.py install --prefix=%tools --optimize=1

mkdir -p %tools/share/meson
cat > %tools/share/meson/meson.config <<-EOF
	[host_machine]
	system = 'linux'
	cpu_family = '$cpu'
	cpu = '$cpuextra'
	endian = '$endian'

	[binaries]
	c = '%tools/bin/$TARGET-clang'
	cpp = '%tools/bin/$TARGET-clang++'
	ar = '%tools/bin/$TARGET-ar'
	ld = '%tools/bin/$TARGET-ld'
	strip = '%tools/bin/$TARGET-strip'
	objcopy = '%tools/bin/$TARGET-objcopy'
	pkgconfig = '%tools/bin/$TARGET-pkg-config'
EOF

cp %files/cross-script %tools/bin/fafnir-meson
sed -i "s|crossfile|%tools/share/meson/meson.config|" %tools/bin/fafnir-meson
