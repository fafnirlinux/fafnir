ver=3.20.4

[srcs]
https://www.cmake.org/files/v3.20/%name-%ver.tar.gz

[build]
sed -i '/"lib64"/s/64//' Modules/GNUInstallDirs.cmake

./bootstrap \
	--prefix=%dest \
	--mandir=/share/man \
	--docdir=/share/doc/cmake
%make
make install

mkdir -p %dest/share/cmake
cat >> %dest/share/cmake/cmake.cross <<-EOF
	set(CMAKE_SYSROOT %rootfs)
	set(CMAKE_C_COMPILER %rootfs/bin/$TARGET-clang)
	set(CMAKE_CXX_COMPILER %rootfs/bin/XTARGET-clang++)
	set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
	set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
	set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
	set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)
EOF
